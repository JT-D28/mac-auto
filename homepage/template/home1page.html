{% load static %}
<!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <title>首页</title>
        <link rel="stylesheet" type="text/css" href="{% static 'manager/layui/css/layui.css' %}">
        <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>
    </head>



    <body style="background-color: #01FF70">


  <div class="layui-row">
      <div class="layui-col-xs5">
          <form class="layui-form" action="">
              <div class="layui-form-item" style="margin-bottom: 3px;margin-top: 3px">
                  <label class="layui-form-label">选择项目:</label>
                  <div class="layui-input-block">
                      <select name="product" lay-filter="test" lay-verify="required">
                          <option value="0">全部</option>
                      </select>
                  </div>
              </div>
          </form>
    </div>
{#    <div class="layui-col-xs3" style="margin-bottom: 3px;margin-top: 3px">#}
{#       <button id='projectset' class="layui-btn layui-btn-radius layui-btn-primary layui-icon layui-icon-set" style="font-size: 30px; color: #1E9FFF;border: 0px"></button>#}
{#    </div>#}
  </div>
<hr style="margin: 0"  color=#987cb9 SIZE=1>



<iframe id='tree-content' name='tree-content' title="test" scrolling="yes" frameborder="0" src="" style="background-color:#0a568c;width:100%;">
            <table id="jacoco">
            <div class="layui-row">
                <div class="layui-col-md8">
                    <div class="layui-col-md6">
                        <div class="layui-card" style="margin-left: 20px;margin-top: 10px">
                            <div class="layui-card-header">代码覆盖率统计
                                <button id='jenkinsset' class="layui-btn layui-btn-radius layui-btn-primary layui-icon layui-icon-set" style="font-size: 30px; color: #1E9FFF;float: right;border: 0px"></button>
                                <button id='jenkinsedit' class="layui-btn layui-btn-radius layui-btn-primary layui-icon layui-icon-edit" style="font-size: 30px; color: #1E9FFF;float: right;border: 0px"></button>
                            </div>
                            <div class="layui-card-body">
                                <div id="bar" style="width:300px; height:200px;">

                                </div>
                            </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </table>


</iframe>





        <form id='addhtml' hidden style="padding:10px;">
          <div class="layui-form-item">
            <label class="layui-form-label">jenkins地址</label>
            <div class="layui-input-block">
              <input type="text" name="jenkinsurl" placeholder="请输入jenkins地址，类似：http://10.60.44.54:9999" autocomplete="off" class="layui-input">
            </div>
          </div>
          <div class="layui-form-item">
            <label class="layui-form-label">job名称</label>
            <div class="layui-input-block">
              <input type="text" name="jobname" placeholder="请输入" autocomplete="off" class="layui-input">
            </div>
          </div>
              <div class="layui-form-item">
            <label class="layui-form-label">服务名称</label>
            <div class="layui-input-block">
              <input type="text" name="servicename" placeholder="请输入" autocomplete="off" class="layui-input">
            </div>
          </div>
        </form>



<script src="{% static 'manager/layui/layui.js' %}"></script>
  <script src="{% static 'manager/js/jquery.min.js' %}"></script>
<script src="{% static 'manager/js/utils.js' %}"></script>
<script type="text/javascript">
layui.use(['layer','table','form'], function(){
  var table = layui.table;
  var layer=layui.layer;
  var form=layui.form;
  var $=layui.jquery;

  success2=function(data){
      console.log('函数列表信息=>'+data)
      data=JSON.parse(data)
      data=data.data
      console.log(data)
      for(var index=0;index<data.length;index++){
        $("[name='product']").append("<option value='"+data[index]['description']+"'>"+data[index]['description']+"</option>")
      }
      layui.form.render('select')
    }
   _post('/homepage/queryproduct/',{},success2)




    form.on('select(test)', function(data){
      console.log(data.value)
    });
{#    var chart = echarts.init(document.getElementById('bar'), 'white', {renderer: 'canvas'});#}
{#        $(function () {#}
{#            fetchData(chart);#}
{#        });#}
{#        function fetchData() {#}
{#            $.ajax({#}
{#                type: "GET",#}
{#                url: "/manager/charttest/",#}
{#                dataType: 'json',#}
{#                success: function (result) {#}
{#                    chart.setOption(result.data);#}
{#                }#}
{#            });#}
{#        }#}

$('#jenkinsset').click(
    function () {
        layui.form.render()
        layer.open({
            type : 1,
            title : "jenkins配置",
            content: $('#addhtml'),
            area: ['600px', '300px'],
            offset: 'auto',
            closeBtn: 2,
            shade: [0.1, '#393D49'],
            shadeClose  :true,
            btn: ['确认', '取消'],
                yes: function(index, layero){
                    success=function(res) {
                        res = JSON.parse(res)
                        if (res.code == 0) {
                            layer.alert(e.msg, {icon: 1, time: 3000})
                        } else {
                            layer.alert(e.msg, {icon: 5, time: 3000})
                        }
                    }
                    data={
                        'product':$("[name='product']").val(),
                        'jenkinsurl':$("[name='jenkinsurl']").val(),
                        'jobname':$("[name='jobname']").val(),
                        'servicename':$("[name='servicename']").val()
                        }
                    _post('/homepage/jenkinsadd/',data,success)
                },
                btn2: function(index, layero){
                    layer.close(index)
                },
                cancel: function(index, layero){
                    layer.close(index)
                }
        })


    }
);




$('#jacocoedit').click(
    function () {

        layui.form.render()
        layer.open({
            type : 1,
            title : "jenkins编辑",
            content: $('#addhtml'),
            area: ['600px', '300px'],
            offset: 'auto',
            closeBtn: 2,
            shade: [0.1, '#393D49'],
            shadeClose  :true,
            btn: ['确认', '取消'],
                yes: function(index, layero){
                    layer.close(index)
                    $.ajax({
                        url:"/manager/jacoco_add/",
                        data:{
                            'jenkinsurl':$("[name='jenkinsurl']").val(),
                            'jobname':$("[name='jobname']").val(),
                            'servicename':$("[name='servicename']").val()
                        },
                        type:"Post",
                        beforeSend:function(){
                            layui.use(['layer'], function(){
                                loadIndex = layer.load(1, {
                                    shade: [0.1, '#393D49'],
                                });
                            })
                        },
                        complete:function(XMLHttpRequest,status){
                            layui.use(['layer'], function(){
                                layer.close(loadIndex);
                            })
                        },
                        dataType:"json",
                        success:function(e){
                            e=JSON.parse(e)
                            if(e.code==0){
                                layer.close(loadIndex);
                                layer.alert(e.msg,{icon:1,time:3000})
                            }else
                                layer.alert(e.msg,{icon:5,time:3000})
                        },
                        error:function(e){
                            layer.alert(e.msg,{icon:5,time:3000})
                        }
                    });
                },
                btn2: function(index, layero){
                    layer.close(index)
                },
                cancel: function(index, layero){
                    layer.close(index)
                }
        })


    }
)




});
</script>

    </body>
    </html>

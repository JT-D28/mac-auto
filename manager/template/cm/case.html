{%load static%}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="{% static 'manager/layui/css/layui.css' %}">

    <title>用例</title>
    <style type="text/css">
      .layui-icon:hover{
        cursor: pointer;
      }
      .icon-tool{
        float: right;

      }
      .icon-tool-item:hover{
        cursor: pointer;
      }
      .icon-tool-item{
        margin-left: 5px;
      }

      #step-selected p{
        height: 30px;
        padding: 0;
      }

      #can-select p:hover{
        background-color: #009688;
        color: white;

      }
      #is-selected p:hover{
        background-color: #009688;
        color:white;

      }
      .func_btn{

        font-size: 10px;
        margin:5px;
      }
      .func_btn:hover{

        cursor: pointer;
        color:#009688;
        font-weight:10px;
      }

    </style>

</head>
<body>



<form id='addcase'  class="layui-form" style="padding: 10px;">
  <span>用例</span>

  <div class="layui-form-item" id='weight_item' hidden>
    <label class="layui-form-label">权重</label>
    <div class="layui-input-block">
      <input type="text" name="weight" placeholder="请输入" autocomplete="off" class="layui-input" id='weight' disabled>
    </div> 
  </div>

  <div class="layui-form-item">
    <label class="layui-form-label">用例名称</label>
    <div class="layui-input-block">
      <input type="text" name="description" placeholder="请输入" autocomplete="off" class="layui-input">
    </div>
  </div>

  <div class="layui-form-item">
    <label class="layui-form-label">DB选择</label>
      <div class="layui-input-block">
      <select name="db_id" lay-verify="">

      </select></div>
  </div>
  <button class="layui-btn" id='save' style="visibility:hidden;">保存</button>

</form>



</div>
</body>
<script src="{% static 'manager/js/jquery.min.js' %}"></script>
<script src="{% static 'manager/layui/layui.js' %}"></script>
<script src="{% static 'manager/js/utils.js' %}"></script>
<script src="{% static 'manager/js/case.js' %}"></script>
<script type="text/javascript">

_load_db_dropdownlist()

layui.use(['table','layer','form'], function(){
  var table = layui.table;
  var $=layui.jquery
  var layer=layui.layer;
  var form=layui.form
  form.render('select')
  uid=_get_query_param('uid')
  pid=_get_query_param('pid')
  // alert(pid)
  action=_get_query_param('action')
  detail='addcase'
    if(action!='view')
      $('#save').css('visibility','visible')
    else{
      $('#save').css('visibility','hidden')
      $('#weight_item').removeAttr('hidden')
    }
  if(uid){
    detail='editcase'

    success=function(data){

      // alert(data)
      description=data.data[0]['description']
      //alert(description)
      $("[name='description']").val(description)
      $("[name='db_id']").val(data.data[0]['db_id'])
      $("[name='weight']").val(data.data[0]['weight'])    
      layui.form.render('select')
    };

    _post('/manager/queryonecase/',{id:uid},success)
  }

  //save
  btn=$('#save')
  if(btn)btn.bind('click',function(e){

    data={
    'uid':uid,
    'pid':pid,
    'action':detail,
    'description':$("[name='description']").val(),
    'dbid':$("[name='db_id']").val()

    }

    _post('/manager/treecontrol/',data,function(data){

      if(data.code==0){
         var treeObj = parent.$.fn.zTree.getZTreeObj('case-manager');
        if(detail=='addcase'){
          var node = treeObj.getNodeByParam('id',pid); 
          console.log('addcase=>'+JSON.stringify(data.data)) 
          treeObj.addNodes(node,data.data);
          treeObj.expandNode(node,true)

        }else{
          var node = treeObj.getNodeByParam('id',uid);
          node.name=data.data['name']
          treeObj.updateNode(node)

        }
        layer.alert(data.msg,{icon:1,time:2000})
      }
      else
        layer.alert(data.msg,{icon:2})



    });


    return false;
  });




  
  
});

</script>

</html>

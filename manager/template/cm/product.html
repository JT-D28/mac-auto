{% load static %}
<!DOCTYPE html>
<html lang="en" style="height: 100%">
<head>
    <meta charset="UTF-8">
    <title>产品</title>
    <link rel="stylesheet" type="text/css" href="{% static 'manager/layui/css/layui.css' %}">
    <style type="text/css">
        .layui-input {
            padding: 0 14px;
            background-color: rgb(252, 252, 252);
            color: black;
        }
    </style>

</head>
<body style="height: 100%">
<div style="width: 100%;height: 6%;background:rgba(245,245,246,1);">
    <legend style="position: relative;top:50%;transform:translateY(-50%);padding-left: 30px">
                <span class="layui-breadcrumb">
                    <a href="">用例管理</a>
                    <a href="">产品</a>
                </span>
    </legend>
</div>
<form id='addproduct' class="layui-form" style="margin: 14px 30px 0 20px;">
    <div class="layui-form-item">
        <label class="layui-form-label">产品名称</label>
        <div class="layui-input-block">
            <input type="text" name="description" autocomplete="off" placeholder="请输入" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <button class="layui-btn" id='save'
                style="visibility:hidden;position: center;width:72px;margin-left:110px;height: 34px;line-height: 34px">
            保存
        </button>
    </div>
</form>
</body>


<script src="{% static 'manager/js/jquery.min.js' %}"></script>
<script src="{% static 'manager/layui/layui.js' %}"></script>
<script src="{% static 'manager/js/utils.js' %}"></script>
<script type="text/javascript">


    layui.use(['layer', 'form', 'element'], function () {
        var $ = layui.jquery;
        var layer = layui.layer;
        var form = layui.form;
        uid = _get_query_param('uid');
        pid = _get_query_param('pid');
        action = _get_query_param('action');
        detail = 'addproduct';
        if (action !== 'view')
            $('#save').css('visibility', 'visible');
        else {
            $('#save').css('visibility', 'hidden');
            _set_form_not_editable()
        }
        if (uid) {
            detail = 'editproduct';
            _post('/manager/queryoneproduct/', {id: uid}, function (data) {
                description = data.data['description'];
                $("[name='description']").val(description)
            })
        }

        btn = $('#save')
        if (btn) btn.bind('click', function (e) {
            data = {
                'uid': uid,
                'pid': pid,
                'action': detail,
                'description': $("[name='description']").val(),
            };
            _post('/manager/treecontrol/', data, function (data) {
                if (data.code === 0) {
                    var treeObj = parent.$.fn.zTree.getZTreeObj('case-manager');
                    if (detail === 'addproduct') {
                        var node = treeObj.getNodeByParam('id', pid);
                        console.log('addproduct=>' + JSON.stringify(data.data));
                        treeObj.addNodes(node, data.data);
                        treeObj.expandNode(node, true)
                    } else {
                        var node = treeObj.getNodeByParam('id', uid);
                        node.name = data.data['name'];
                        treeObj.updateNode(node)
                    }
                    layer.alert(data.msg, {icon: 1, time: 2000})
                } else
                    layer.alert(data.msg, {icon: 2})
            });
            return false;
        });
    });

</script>

</html>

{%load static%}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- bootstrap 4.x is supported. You can also use the bootstrap css 3.3.x versions -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" crossorigin="anonymous">
    <link href="{% static 'manager/bootstrap-fileinput-master/css/fileinput.css'%}" media="all" rel="stylesheet" type="text/css"/>
    <link href="{% static 'manager/bootstrap-fileinput-master/themes/explorer-fas/theme.css'%}" media="all" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" type="text/css" href="{% static 'manager/layui/css/layui.css' %}">
    <title>数据迁移</title>
    <style type="text/css">
      
      .layui-icon:hover{
        cursor: pointer;
      }
    </style>
</head>
<body>



<!-- 上传区域 -->
<input id="kv-explorer" type="file" multiple>
</body>
<script src="{% static 'manager/js/jquery.min.js' %}"></script>
<script src="{% static 'manager/js/utils.js' %}"></script>
<script src="{% static 'manager/layui/layui.js' %}"></script>

<script src="{% static 'manager/js/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'manager/bootstrap-fileinput-master/js/plugins/piexif.js' %}"></script>
<script src="{% static 'manager/bootstrap-fileinput-master/js/plugins/sortable.js' %}"></script>
<script src="{% static 'manager/bootstrap-fileinput-master/js/fileinput.js' %}"></script>
<script src="{% static 'manager/bootstrap-fileinput-master/js/locales/fr.js' %}"></script>
<script src="{% static 'manager/bootstrap-fileinput-master/js/locales/es.js' %}"></script>
<script src="{% static 'manager/bootstrap-fileinput-master/themes/fas/theme.js' %}"></script>
<script src="{% static 'manager/bootstrap-fileinput-master/themes/explorer-fas/theme.js' %}"></script>




<script type="text/javascript">
layui.use(['table','layer','upload'], function(){
  var table = layui.table;
  var upload=layui.upload;
  var $=layui.jquery
  var layer=layui.layer;
  var form = layui.form;

//


$("#kv-explorer").fileinput({
    'theme': 'explorer-fas',
    'uploadUrl': '/manager/upload/',
    'minFileCount':1,
    'uploadAsync':false,
    uploadExtraData: function(previewId, index) {   //额外参数的关键点
        var obj = {

        };
        obj.kind='datamovein'
        obj.content_type='json'

        return obj;
    }
    // 'allowedFileTypes':['json','xlsx']
    // overwriteInitial: false,

});

$('#kv-explorer').on('filebatchuploaderror', function(event, data, msg) {
  layer.alert('转换异常['+msg+']',{icon:2})
 
});

$('#kv-explorer').on('filebatchuploadsuccess', function(event, data, previewId, index) { 
 // alert(JSON.stringify(data))

 response=JSON.parse(data.response)

 if(response.code==0){
  layer.alert(response.msg,{icon:1})
 }else{
  layer.alert(response.msg,{icon:2})
 }
});
  //




  });






</script>

<script type="text/html" id="toolbar">
  <i class="layui-icon layui-icon-form" lay-event="detail"></i>
  <i class="layui-icon layui-icon-edit" lay-event="edit"></i>

  
</script>
</html>

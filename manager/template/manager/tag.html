{%load static%}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="{% static 'manager/layui/css/layui.css' %}">

    <title>标签管理</title>


</head>
<body>
<div class="layui-inline"> 
	<div class="layui-input-inline"><input id='search-value' type="text" name="" placeholder="标签名" class="layui-input"></div>
	<button class="layui-btn" id='querybtn'>查询</button>
  <button class="layui-btn" id='addbtn'>新增</button>
  <button class="layui-btn layui-btn-danger" id='delbtn'>删除</button>

</div>

<table id='table-tag' class="layui-table" lay-data="{height:400, cellMinWidth: 80, page: true, limit:10, url:'{{BASE_URL}}/manager/querytag/'}" lay-filter='target'>
  <thead>
    <tr>
      <th lay-data="{type:'checkbox'}"></th>
      <th lay-data="{field: 'id',width:80,hide:true}">ID</th>
      <th lay-data="{field: 'name', sort: true}">名称</th>
      <th lay-data="{field: 'author', sort: true}">创建者</th>
      <th lay-data="{field: 'createtime',sort:true}">创建时间</th>
      <th lay-data="{field: 'updatetime',sort:true}">更新时间</th>
      
 
    </tr>
  </thead>
</table>

<div id='addtag' hidden=true class="layui-form">
  <div class="layui-form-item">
    <label class="layui-form-label">名称</label>
    <div class="layui-input-block">
      <input type="text" name="" placeholder="请输入" autocomplete="off" class="layui-input">
    </div>
  </div>


</div>


</div>
</body>

<script src="{% static 'manager/js/jquery.min.js' %}"></script>
<script src="{% static 'manager/layui/layui.js' %}"></script>
<script src="{% static 'manager/js/utils.js' %}"></script>

<script type="text/javascript">
layui.use(['table','layer','transfer'], function(){
  var table = layui.table;
  var $=layui.jquery
  var layer=layui.layer;
  var transfer=layui.transfer;
//
//添加步骤穿梭框

  $(".step-transfer").each(function(){

    transfer.render({
      elem: this,  //绑定元素
      title:['分配步骤','已选'],
      showSearch:true
      ,data: [
        {"value": "1", "title": "登陆操作", "disabled": "", "checked": "",'t':'1'}
        ,{"value": "2", "title": "新建工作流类型", "disabled": "", "checked": "",'t':'2'}
        ,{"value": "3", "title": "委托操作", "disabled": "", "checked": "","t":"3"}
      ],
      onchange:function(data,index){
        alert(data[0]["t"]);
        data=[]
        console.log(JSON.stringify(data))
        alert(index)

      }
      ,id: 'transfer-id' //定义索引
    });
  });




//查询功能
  $("#querybtn").click(function(e){

    console.log('query case');
    table.reload('table-tag',{
      page:{
        curr:1
      },
      where:{
        searchvalue:$("#search-value").val()

      }

    });

    
  });

//删除功能
  $("#delbtn").click(function(e){


    var checkStatus = table.checkStatus("table-tag");
    data = checkStatus.data; //获取选中的数据

    if(data.length==0){
      layer.alert('你有选择删除的变量么?',{icon:3,time:1500})
      return

    };

    layer.confirm('确认删除么?',{
    btn1:function(index,layero){
      layer.close(index)
      success=function(e){

        if(e.code==0){
          table.reload('table-tag',{
              page:{
                curr:1
              },
              where:{
                searchvalue:$("#search-value").val()

              }

            });
          layer.alert(e.msg,{icon:1,time:1500})
        }
        else
          layer.alert(e.msg,{icon:2})

      }

      ids=[]
      for(var index=0;index<data.length;index++){
        ids.splice(0,0,data[index]['id'])

      }
  
      _post('/manager/deltag/',{'ids':ids.join()},success)


    },

  });



  });

//新增功能

  $("#addbtn").click(function(e){
    layer.prompt({
      title:'添加标签',
      maxlength:10,
      value:''
    
    },function(value, index, elem){

      

      layer.close(index);
      _post('/manager/addtag/',{'name':value},function(e){

        //console.log(e)
        if(e.code==0){
          table.reload('table-tag',{
              page:{
                curr:1
              },
              where:{
                searchvalue:$("#search-value").val()

              }

            });

          layer.alert(e.msg,{icon:1,time:1500})
        }
        else
          layer.alert(e.msg,{icon:2})

      })




    })

  });

//tool事件
  table.on("tool(target)",function(e){
    console.log(e.event);


    var checkStatus = table.checkStatus("table-tag");
    data = checkStatus.data; //获取选中的数据
    
    if(e.event=='edit'){

      console.log(data);

    }else if(e.event=='detail'){

    }else if(e.event=='addstep'){
      layer.open(
        {
          title:'新增测试步骤',
          type:1,
          content:$('#addstep'),
          btn:['提交','取消'],
          area:["500px","400px"],

          yes: function(index, layero){
            //按钮【按钮一】的回调
            console.log('yes')
          },
          btn2: function(index, layero){
            //按钮【按钮二】的回调
            //return false 开启该代码可禁止点击该按钮关闭
            console.log('no')
          },


      });
    }

  });




  
  
});

// $(document).ready(function(){

// });
</script>


</html>

{% load static %}
<!DOCTYPE html>
<html style="height: 100%">
<head>
    <meta charset="utf-8">
    <title>树组件</title>
    <link rel="stylesheet" type="text/css" href="{% static 'manager/ztree/zTreeStyle.css' %}">
    <!--   <link rel="stylesheet" type="text/css" href="{% static 'manager/ztree/demo.css' %}"> -->
    <link rel="stylesheet" type="text/css" href="{% static 'manager/icomoon/style.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'manager/font-awesome-4.7.0/css/font-awesome.min.css' %}">

    <link rel="stylesheet" type="text/css" href="{% static 'manager/bootstrap/bootstrap.min.css' %}">
    <link href="{% static 'manager/bootstrap-fileinput-master/css/fileinput.css' %}" media="all" rel="stylesheet"
          type="text/css"/>
    <link href="{% static 'manager/bootstrap-fileinput-master/themes/explorer-fas/theme.css' %}" media="all"
          rel="stylesheet" type="text/css"/>

    <link rel="stylesheet" type="text/css" href="{% static 'manager/layui/css/layui.css' %}">


    <style type="text/css">

        .layui-tree-entry{
            height: auto;
            padding:4px 0;
        }
        .layui-tree-iconClick{
            margin-right: 8px;
            margin-left: 0px;
        }
        .layui-table-view{
            margin: 0 0;
        }
        .layui-table th, .layui-table td{
            font-size: 12px;
        }
        .card{
            padding: 0 25px;
            line-height: 30px;
            height: 30px;
        }

        .ztree li span.button.add {
            margin-left: 2px;
            margin-right: -1px;
            background-position: -144px 0;
            vertical-align: top;
            *vertical-align: middle
        }

        .ztree li span.button.diy01_ico_open, .ztree li span.button.diy01_ico_close {
            margin-right: 2px;
            background: url(../../static/manager/ztree/img/diy/1_open.png) no-repeat scroll 0 0 transparent;
            vertical-align: top;
            *vertical-align: middle
        }

        .ztree li span.button.diy02_ico_docu {
            margin-right: 2px;
            background: url(../../static/manager/ztree/img/diy/2.png) no-repeat scroll 0 0 transparent;
            vertical-align: top;
            *vertical-align: middle
        }

        .ztree li span.button.diy03_ico_docu {
            margin-right: 2px;
            background: url(../../static/manager/ztree/img/diy/3.png) no-repeat scroll 0 0 transparent;
            vertical-align: top;
            *vertical-align: middle
        }

        .fa {

            /*color: #FF6699;*/
            color:#009688;

        }
        .btn{
            width:72px;
            height:34px;
            background:rgba(0,151,136,1);
            border-radius:0px 2px 2px 0px;
        }
        .btn-text{
            width:24px;
            height:17px;
            font-size:12px;
            font-family:PingFang-SC-Medium,PingFang-SC;
            font-weight:500;
            color:rgba(255,255,255,1);
            line-height:17px;
        }

        /*.fa{
          color: #6699CC;
        }*/
        /*.fa.fa-plus{
          color:#CCCCCC;

        }
        .fa.fa-minus{
          color:#CCCCCC;

        }*/
        .fa.fa-folder {
            color: #FFCC66;

        }

        .fa.fa-folder-open {
            color: #FFCC66;
        }

        /*  .fa.fa-file-o{
            color:#c2c2c2;
          }
          .fa.fa-database{
            color:#c2c2c2;
          }
          .fa.fa-star{
            color:#FFCC00;
          }

          .fa.fa-product-hunt{

            color:#00CC99;
          }
          .fa.fa-leaf{

             color:#00CC99;
          }
          .fa.fa-home{
            color:#66CCCC;
          }
          .fa.fa-folder{
            color:#FFCC66;

          }

          .fa.fa-folder-open{
            color:#FFCC66;
          }

          .fa.fa-info{
            color:#FF0033;
          }
          .fa.fa-facebook{
            color: #FF9999;

          }*/


    </style>
</head>
<body style="height:100%;">
<script>


    function changeFrameHeight() {
        var ifm = document.getElementById("tree-content");
        ifm.maxHeight = ifm.height = document.documentElement.clientHeight;
    }

    window.onresize = function () {
        changeFrameHeight();
    }
    /**
     function calcPageHeight(doc) {
          var cHeight = Math.max(doc.body.clientHeight, doc.documentElement.clientHeight)
          var sHeight = Math.max(doc.body.scrollHeight, doc.documentElement.scrollHeight)
          var height  = Math.max(cHeight, sHeight)
          return height
      }
     var ifr = document.getElementById('tree-content')
     ifr.onload = function() {
      	  //解决打开高度太高的页面后再打开高度较小页面滚动条不收缩
      	  ifr.style.height='0px';
          var iDoc = ifr.contentDocument || ifr.document
          var height = calcPageHeight(iDoc)
          if(height < 490){
          	height = 490;
          }
          ifr.style.height = height + 'px'
      }**/
</script>

<div style="margin-left: 25px;margin-right: 50px;height: 100%">

    <div class="layui-row" style="height: 100%;">
        <div id='treelist' class="layui-col-md5 " style="max-height:100%;overflow-y:auto;padding: 20px">
            <div class="layui-inline">
                <input type="input" name="" placeholder="" style='width:240px;height:34px;background:rgba(255,255,255,1);border-radius:2px;border:1px solid rgba(220,222,224,1);' id='search' autocomplete="off">
                <button id='searchbtn' class="btn" ><span class='btn-text'>查询</span></button>
            </div>
            <ul id="case-manager" class="ztree" style="margin-bottom: 20px"></ul>

        </div>

        <div class="layui-col-md7" style="min-height:100%;overflow-y:auto;">
            <iframe id='tree-content' name='tree-content' title="test" scrolling="yes" frameborder="0" src=""
                    style="overflow-y:auto;width:100%;" onload="changeFrameHeight()"></iframe>

        </div>
    </div>
</div>



<div id='import-div' style="padding:5px;" hidden>
    <input id="file-explorer" type="file" multiple>
</div>


<div id="test" hidden class="layui-row" style="height: 100%;">
    <div class="layui-col-md2 " style="height:100%;border-right:4px solid #f6f6f6;overflow-y:auto;">
        <div class="layui-card">
            <div class="layui-card-header card">用例:</div>
            <div class="layui-card-body" style="padding: 0 8px">
                <ul id="demo1"></ul>
            </div>
        </div>
    </div>

    <div class="layui-col-md2 " style="height:100%;border-right:4px solid #f6f6f6;overflow-y:auto;">
        <div class="layui-col-md12" style="height: 45%;overflow-y:auto;">
            <div class="layui-card">
                <div class="layui-card-header card">步骤:</div>
                <div class="layui-card-body" style="padding: 0 8px">
                    <ul id="demo2"></ul>
                </div>
            </div>
        </div>
        <div class="layui-col-md12" style="height: 45%;overflow-y:auto;">
            <div class="layui-card">
                <div class="layui-card-header card">测试点:</div>
                <div class="layui-card-body" style="padding: 0 8px">
                    <ul id="demo3"></ul>
                </div>
            </div>
        </div>
        <div class="layui-col-md12" style="height: 10%;overflow-y:auto;">
            <button type="button" class="layui-btn" id="downloadlog" style="width: inherit">
                <i class="layui-icon">&#xe601;</i> 下载完整日志
            </button>
        </div>
    </div>
    <div id='debuginfo' class="layui-col-md8" style="height:100%;overflow-y:auto;">
        <div class="layui-card-body">
            <div id="log_text"></div>
        </div>
    </div>
</div>





<script src="{% static 'manager/layui/layui.js' %}"></script>
<script src="{% static 'manager/js/jquery.min.js' %}"></script>
<script src="{% static 'manager/js/utils.js' %}"></script>

<script src="{% static 'manager/ztree/jquery.ztree.all.min.js' %}"></script>
<!-- <script src="{% static 'manager/ztree/jquery.ztree.core.min.js' %}"></script> -->
<script src="{% static 'manager/ztree/jquery.ztree.core.js' %}"></script>
<script src="{% static 'manager/ztree/jquery.ztree.excheck.min.js' %}"></script>
<script src="{% static 'manager/ztree/jquery.ztree.exedit.js' %}"></script>
<script src="{% static 'manager/js/mytree.js' %}"></script>

<script src="{% static 'manager/js/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'manager/bootstrap-fileinput-master/js/plugins/piexif.js' %}"></script>
<script src="{% static 'manager/bootstrap-fileinput-master/js/plugins/sortable.js' %}"></script>
<script src="{% static 'manager/bootstrap-fileinput-master/js/fileinput.js' %}"></script>
<script src="{% static 'manager/bootstrap-fileinput-master/js/locales/fr.js' %}"></script>
<script src="{% static 'manager/bootstrap-fileinput-master/js/locales/es.js' %}"></script>
<script src="{% static 'manager/bootstrap-fileinput-master/themes/fas/theme.js' %}"></script>
<script src="{% static 'manager/bootstrap-fileinput-master/themes/explorer-fas/theme.js' %}"></script>
<script type="text/javascript">
    tree.init()


    //search
    //  $('#search').on('input propertychange', function() {
    //   console.log($('#search').val())
    //   tree.init($('#search').val())
    // });

    $('#searchbtn').click(function (argument) {
        tree.init($('#search').val())
    })

    //add

    $('#add_product').click(function (e) {
        layer.prompt({
            formType: 0,
            value: '',
            title: '新建产品'
        }, function (value, index, elem) {

            layer.close(index);
            _post('/manager/treecontrol/', {'description': value, 'action': 'addproduct'}, function (data) {
                if (data.code == 0)
                    layer.alert(data.msg, {icon: 1, time: 2000})
                else
                    layer.alert(data.msg, {icon: 2})

            })
        })


    })


    //

    $("#file-explorer").fileinput({
        'theme': 'explorer-fas',
        'uploadUrl': '/manager/upload/',
        'minFileCount': 1,
        'uploadAsync': false,
        uploadExtraData: function (previewId, index) {   //额外参数的关键点
            var obj = {};
            obj.kind = 'dataimport'
            // obj.content_type='json'

            return obj;
        }
        // 'allowedFileTypes':['json','xlsx']
        // overwriteInitial: false,

    });


    $('#file-explorer').on('filebatchuploaderror', function (event, data, msg) {
        layer.alert('转换异常[' + msg + ']', {icon: 2})

    });

    $('#file-explorer').on('filebatchuploadsuccess', function (event, data, previewId, index) {
        // alert(JSON.stringify(data))
        // alert('success')
// console.log(data)
        response = JSON.parse(data.response)

        if (response.code == 0) {
            layer.alert(response.msg, {icon: 1})
        } else {
            layer.alert(response.msg, {icon: 2})
        }
    });

    window.onload = function () {
        document.documentElement.style.overflow = 'hidden';
    }

    layui.use(['util'], function () {
        var util = layui.util;
        util.fixbar({
            bar1: "↻"
            , css: {right: 10, bottom: '10%'}
            , bgcolor: '#009788'
            , click: function () {
                 document.getElementById('tree-content').contentWindow.location.reload();
            }
        });
    });

</script>
</body>
</html>